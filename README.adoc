:source-highlighter: highlight.js
:versionPlaceholder: x.y.z

= Maven Central Portal Publisher

Gradle plugin for publishing to Maven Central via https://central.sonatype.org/publish/publish-portal-api/[Publisher API].

== Installation

[source,kotlin]
----
plugins {
    id("io.github.zenhelix.maven-central-publish") version "{versionPlaceholder}"
}
----

== Overview

Plugin applies `maven-publish` and `signing` plugins automatically, then extends publishing workflow with Maven Central Portal integration:

* Creates checksum files (MD5, SHA1, SHA256, SHA512) for all artifacts
* Packages artifacts, signatures, and checksums into deployment bundles (ZIP)
* Uploads bundles via Publisher API
* Polls deployment status until completion

Supports both single-module and multi-module projects with automatic aggregation.

== Configuration

[source,kotlin]
----
mavenCentralPortal {
    credentials {
        username = providers.gradleProperty("mavenCentralUsername")
        password = providers.gradleProperty("mavenCentralPassword")
    }
    publishingType = PublishingType.AUTOMATIC
    deploymentName = "my-deployment"

    uploader {
        maxStatusChecks = 20
        statusCheckDelay = Duration.ofSeconds(10)
    }
}
----

[cols="1,3"]
|===
|Property |Description

|`credentials.username`
|Maven Central username or token username

|`credentials.password`
|Maven Central password or token password

|`publishingType`
|`AUTOMATIC` - auto-publish after validation +
`USER_MANAGED` - manual publish via Portal UI +
Default: `AUTOMATIC`

|`deploymentName`
|Optional deployment identifier in Portal +
Default: `null` (auto-generated)

|`uploader.maxStatusChecks`
|Max status polling attempts +
Default: `20`

|`uploader.statusCheckDelay`
|Delay between status checks +
Default: `10 seconds`
|===

Generate tokens at https://central.sonatype.org/publish/generate-portal-token/[generate-portal-token]

== Tasks

Plugin registers tasks per publication and aggregation tasks:

=== Per-Publication Tasks

* `checksum<Publication>Publication` - Generate checksums
* `zipDeployment<Publication>Publication` - Create ZIP bundle
* `publish<Publication>PublicationToMavenCentralPortalRepository` - Upload bundle

=== Aggregation Tasks

* `checksumAllPublications` - Generate checksums for all publications
* `zipDeploymentAllPublications` - Bundle all publications
* `publishAllPublicationsToMavenCentralPortalRepository` - Upload all publications

=== Multi-Module Tasks

For root project with subprojects:

* `zipDeploymentAllModules` - Bundle all modules
* `publishAllModulesToMavenCentralPortalRepository` - Upload all modules

== Lifecycle Task Behavior

Plugin integrates with Gradle's `publish` lifecycle task:

=== Single-Module Projects

When root project has publications and no subprojects with publications:

[source,bash]
----
./gradlew publish
----

Executes: `publishAllPublicationsToMavenCentralPortalRepository`

=== Multi-Module Projects

When subprojects have publications:

[source,bash]
----
./gradlew publish
----

Executes: `publishAllModulesToMavenCentralPortalRepository`

Aggregates all publications from root and subprojects into single deployment bundle.

== Usage

=== Single Module

[source,kotlin]
----
publishing {
    repositories {
        mavenCentralPortal {
            credentials {
                username = sonatypeUser
                password = sonatypePassword
            }
        }
    }

    publications {
        create<MavenPublication>("mavenJava") {
            from(components["java"])

            pom {
                name = "My Library"
                description = "Library description"
                url = "https://github.com/user/repo"

                licenses {
                    license {
                        name = "Apache License 2.0"
                        url = "https://www.apache.org/licenses/LICENSE-2.0.txt"
                    }
                }

                developers {
                    developer {
                        id = "userid"
                        name = "User Name"
                        email = "user@example.com"
                    }
                }

                scm {
                    connection = "scm:git:git://github.com/user/repo.git"
                    developerConnection = "scm:git:ssh://github.com/user/repo.git"
                    url = "https://github.com/user/repo"
                }
            }
        }
    }
}

signing {
    val signingKey: String? by project
    val signingPassword: String? by project
    useInMemoryPgpKeys(signingKey, signingPassword)
    sign(publishing.publications)
}
----

[source,bash]
----
./gradlew publishAllPublicationsToMavenCentralPortalRepository
----

=== Multi-Module

Apply plugin to root and subprojects.
Root task aggregates all modules:

[source,bash]
----
./gradlew publishAllModulesToMavenCentralPortalRepository
----

== Requirements

* Gradle 8.0+
* Java 17+
* Valid Maven Central account
* POM metadata: name, description, url, licenses, developers, scm
* Signed artifacts

== License

Licensed under the **Apache License, Version 2.0**.
For more details, see the link:LICENSE[LICENSE file] in the root of this repository.